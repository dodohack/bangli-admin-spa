<editor-page-header [authState]="authState" [isPost]="true"
                    [entity]="post" [lists]="postsState">
</editor-page-header>

<form *ngIf="post" (ngSubmit)="save()" #postForm="ngForm">

<!-- Post title and main buttons -->
<div class="row post-meta-row">
    <div class="col-xs-7 col-sm-7 col-md-8">
        <div class="input-group">
            <span class="input-group-addon">标题</span>
            <input type="text" name="title" class="form-control post-title"
                   [(ngModel)]="post.title" placeholder="文章标题" required>
        </div>
    </div>

    <div class="col-xs-5 col-sm-5 col-md-4">
        <!-- Save buttons -->
        <div class="float-right">
            <button type="submit" class="btn btn-sm btn-outline-success"
                    [disabled]="!postForm.form.dirty && postForm.form.valid">保存</button>

            <button class="btn btn-sm btn-outline-primary"
                    (click)="save2Pending()" [disabled]="!isDraft">提交审稿</button>

            <button class="btn btn-sm btn-outline-danger"
                    (click)="save2Draft()" *ngIf="isPending || isPublish">保存为草稿</button>

            <button class="btn btn-sm btn-outline-danger"
                    (click)="save2Publish()" [disabled]="isPublish">发布</button>
        </div>
    </div>
</div>

<!-- author/editor/post_type/creative_type selectors -->
<div class="row post-meta-row">
    <div class="col-xs-12 form-inline">

            <div class="form-group post-meta">
                <label>作者</label>
                <select class="form-control form-control-sm custom-select" name="author_id" [(ngModel)]="post.author_id">
                    <option *ngFor="let author of cmsState.authors"
                            [selected]="author.id === post.author_id || (!post.author_id && authState.users[authState.key].id === author.id)"
                            [value]="author.id">{{ author.display_name }}</option>
                </select>
            </div>

            <div class="form-group post-meta">
                <label>编辑</label>
                <select class="form-control form-control-sm custom-select" name="editor_id" [(ngModel)]="post.editor_id">
                    <option *ngFor="let editor of cmsState.editors"
                            [selected]="editor.id === post.editor_id || (!post.editor_id && authState.users[authState.key].id === editor.id)"
                            [value]="editor.id">{{ editor.display_name }}</option>
                </select>
            </div>

            <div class="form-group post-meta">
                <label>文章类型</label>
                <select class="form-control form-control-sm custom-select" name="post_type" [(ngModel)]="post.post_type">
                    <option *ngFor="let pt of cmsState.post_types.available"
                            [selected]="post.post_type === pt.post_type"
                            [value]="pt.post_type">{{ zh[pt.post_type] }}</option>
                </select>
            </div>

            <div class="form-group post-meta">
                <label>原创类型</label>
                <select class="form-control form-control-sm custom-select" name="c_type" [(ngModel)]="post.creative_type">
                    <option *ngFor="let c_type of cmsState.post_creative_types.available"
                            [selected]="post.creative_type === c_type.creative_type"
                            [value]="c_type.creative_type">{{ zh[c_type.creative_type] }}</option>
                </select>
            </div>

    </div>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="form-inline post-ctt-wrapper">
            <!-- Post category, tag, topic etc -->
            <post-ctt-cloud [post]="post" (toggle)="toggleRightBar($event)"></post-ctt-cloud>
        </div>
    </div>
</div>

<!-- Froala Editor -->
<froala *ngIf="inputPost" [froalaOptions]="froalaOptions"
        [froalaData]="inputPost.content" (model)="postContentChanged($event)"></froala>

<div class="row">
    <div class="col-xs-8">
        <div class="form-group">
            <label>摘要</label>
            <textarea name="excerpt" [(ngModel)]="post.excerpt" class="form-control" rows="3"></textarea>
        </div>
    </div>
    <div class="col-xs-4">
        <div style="width: 300px; height: 300px; border: 3px solid green;">
            缩略图
        </div>
    </div>
</div>

</form>

<!-- Right panel -->
<right-panel [width]="'400px'" [isOpen]="false">
    <tabset [justified]="true">
        <tab heading="分类" [active]="tabs['cat']"
             (select)="tabs['cat'] = true" (deselect)="tabs['cat'] = false">
            <category-tree [isTreeRoot]="showFilter"
                           [categories]="cmsState.categories"
                           (checkEvent)="checkCat($event)">
            </category-tree>
        </tab>

        <tab heading="标签" [active]="tabs['tag']"
             (select)="tabs['tag'] = true" (deselect)="tabs['tag'] = false">
            <tag-cloud [tags]="cmsState.tags" (checkEvent)="checkTag($event)"></tag-cloud>
        </tab>

        <tab heading="专题" [active]="tabs['topic']"
             (select)="tabs['topic'] = true" (deselect)="tabs['topic'] = false">
            <topic-cloud [topics]="cmsState.post_topic_cats"
                         (checkEvent)="checkTopic($event)"></topic-cloud>
        </tab>
    </tabset>
</right-panel>
