<script>

    /* FIXME: Move this to .env. License for new.huluwa.uk */
    $.FroalaEditor.DEFAULTS.key = 'GhbC-7A26bB-21d1xynF1dy==';

/* Form data to submit */
var formData = new Array();

$(function() {
    $('#edit')
        .froalaEditor({

            /*
             * Save the content
             */
            saveParam: 'content',
            saveURL: '/admin/api/ajax/saveCmsPost',
            saveMethod: 'POST',

            /* Past in WYSIWYG edit in plain text */
            pastePlain: true,

            /* Editor height in pixel */
            height: 600,

            /* Toolbars */
            toolbarButtons: ['fullscreen', 'bold', 'italic', 'underline',
                'fontSize', 'color',
                'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent',
                'indent', 'insertHR', 'insertLink',
                'insertImage', 'insertVideo', 'insertFile',
                'insertTable', 'undo', 'redo', 'clearFormatting', 'html'],

            toolbarButtonsMD: ['fullscreen', 'bold', 'italic', 'underline',
                'fontSize', 'color',
                'paragraphFormat', 'align', 'formatOL', 'formatUL', 'outdent',
                'indent', 'insertHR', 'insertLink',
                'insertImage', 'insertVideo', 'insertFile',
                'insertTable', 'undo', 'redo', 'clearFormatting', 'html'],

            toolbarSticky: false,

            /* Language */
            language: 'zh_cn',
        })
        .on('froalaEditor.save.before', function (e, editor) {
            /* Get all form data */
            $.each($('#editor').serializeArray(), function() {
                formData[this.name] = this.value;
            });
            editor.opts.saveParams = formData;

            // Popup 'Saving...'
            $('#loadingModal').modal('toggle');
        })
        .on('froalaEditor.save.after', function (e, editor, response) {
            var decodedResponse = $.parseJSON(response);

            // Update client side view on success
            if (decodedResponse['status'] == 0)
            {
                //window.history.pushState("object or string", "Title", "/xxx.html");
                //decodedResponse['post_id']);
            }

            // Show return status
            $('#loadingText').html(decodedResponse['message']);
        })
        .on('froalaEditor.save.error', function (e, editor, error) {
            // This seems to be only used by image upload
            alert("froalaEditor.save.error triggered");
        })
});

$('#btnSave').click(function(e) {
    e.preventDefault();
    $('#edit').froalaEditor('save.save');
})
</script>
